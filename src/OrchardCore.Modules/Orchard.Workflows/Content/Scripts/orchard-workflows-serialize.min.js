var saveLocal=function(n){for(var i,f,r,u={Activities:[],Connections:[]},e=$(".activity"),t=0;t<e.length;t++)i=e[t],u.Activities.push({Name:i.viewModel.name,ClientId:i.viewModel.clientId,Start:i.viewModel.start,State:i.viewModel.state,Left:$(i).position().left,Top:$(i).position().top});for(f=jsPlumb.getConnections(),t=0;t<f.length;t++)r=f[t],u.Connections.push({SourceId:r.sourceId,TargetId:r.targetId,SourceEndpoint:r.endpoints[0].outcome.Id});sessionStorage.setItem(n,JSON.stringify(u))},updateActivities=function(n){var t=loadWorkflow(n),i,r;if(t!=null){if(updatedActivityState!=null){for(i=0;i<t.Activities.length;i++)r=t.Activities[i],updatedActivityClientId==r.ClientId&&(r.State=JSON.parse(updatedActivityState));displaySaveMessage()}sessionStorage.setItem(n,JSON.stringify(t))}},loadActivities=function(n){var r=loadWorkflow(n),i,t;if(r!=null){for(t=0;t<r.Activities.length;t++)i=r.Activities[t],renderActivity(i.ClientId,i.Id,i.Name,i.State,i.Start,i.Top,i.Left);for(t=0;t<r.Connections.length;t++){var u=r.Connections[t],f=document.getElementById(u.SourceId),e=f.endpoints[u.SourceEndpoint];jsPlumb.connect({source:e,target:u.TargetId,deleteEndpointsOnDetach:!1})}return refreshStateMessage(),r}},loadWorkflow=function(n){var t=sessionStorage.getItem(n);if(t)return JSON.parse(t)},getActivity=function(n,t){var r=loadWorkflow(n),u,i,f;if(r!=null){for(u=null,i=0;i<r.Activities.length;i++)f=r.Activities[i],f.ClientId==t&&(u=f);return u}},loadForm=function(n,t){var i=getActivity(n,t);bindForm($("form"),i.State)},bindForm=function(n,t){$.each(t,function(n,t){var i=$('[name="'+n+'"]'),u=i.get(0).nodeName.toLowerCase(),f=i.attr("type")&&i.attr("type").toLowerCase(),r=t.split(",");switch(u){case"input":switch(f){case"checkbox":i.each(function(){var n=$(this);n.attr("checked",r.indexOf(n.attr("value"))!=-1)});break;case"radio":i.filter('[value="'+t+'"]').attr("checked","checked");break;default:i.val(t)}break;case"select":i.val(r);break;default:i.val(t)}})};